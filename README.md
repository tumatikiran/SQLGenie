# db-chatbot-gemini
Local web application to ask natural language questions about a Microsoft SQL Server database and execute safe, read-only SQL generated by Google Gemini.

## Prerequisites
- Microsoft SQL Server running locally (or reachable from this machine)
- A dedicated SQL Server login/user with **read-only** permissions to the target database
- ODBC Driver 18 for SQL Server installed
- Python 3.10+
- Node.js 18+
- A Google Gemini API key

## Backend setup (FastAPI)
1. Create and activate a virtual environment:
   - Windows PowerShell:
     - `python -m venv .venv`
     - `.\.venv\Scripts\Activate.ps1`

2. Install dependencies:
   - `cd backend`
   - `pip install -r requirements.txt`

3. Configure environment variables:
   - Copy `backend/.env.example` to `backend/.env`
   - Fill in all values (SQL Server + `GOOGLE_API_KEY`)

4. Run the backend:
   - `uvicorn main:app --reload --host 127.0.0.1 --port 8000`

The backend loads the database schema **once** on startup and reuses it for all requests.

## Frontend setup (React + Vite)
1. Install dependencies:
   - `cd frontend`
   - `npm install`

2. (Optional) Configure API URL via Vite env:
   - Create `frontend/.env` with:
     - `VITE_API_BASE_URL=http://localhost:8000`

3. Run the frontend:
   - `npm run dev`

Open the app at `http://localhost:5173`.

## API
### POST /chat
Request:
```json
{
  "question": "Which customers placed the most orders last month?"
}
```

Response:
```json
{
  "question": "...",
  "sql": "SELECT TOP (100) ...",
  "columns": ["..."],
  "rows": [["..."]]
}
```

Example cURL:
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d "{\"question\":\"List the top 10 products by total revenue\"}"
```

### GET /tables
Returns an array of table names for the sidebar.

## Security notes
- Use a SQL Server login/user that has **read-only** permissions (e.g., `db_datareader`) and no write/DDL permissions.
- The backend validates and normalizes SQL before execution:
  - Only a single SELECT statement is allowed
  - CTEs are disallowed
  - Comments are disallowed
  - Dangerous keywords are blocked
  - `TOP (100)` is enforced (and any higher `TOP` is capped)
- Do not expose the backend to untrusted networks without additional hardening (authn/authz, network controls, auditing).
